---
layout: post
subclass: post
title: "파이썬 프로그래밍 입문(9) 파일"
date: 2019-05-17 00:00:09
tags: [python-programming, file]
excerpt: "파이썬 프로그래밍 입문, 파일에 대한 설명입니다."
disqus: True
---

## with문과 context manager

파일 관련 작업을 하거나 데이터베이스 연결을 하는 등 컴퓨터의 자원에 접근하는 일은 빈번합니다. 또, 컴퓨터의 자원은 제한적입니다. 그러므로 사용 후에는 자원을 반납해야 합니다. 그렇지 않으면 메모리 누수가 생기는 것처럼 시스템의 자원이 새게 되는 상황이 생깁니다.

그러므로 앞서 말씀드렸던 것처럼 file을 프로그램에서 열어서 작업한 다음에는 파일 객체의 close 메서드를 호출해 자원을 반납해야 합니다.

이러한 작업을 알아서 해주는 것이 with문입니다.

```python
with open("test.txt") as f:
    data = f.read()
```

위와 같이 코드를 작성하면 with 블록을 벗어나는 순간 열린 파일 객체가 자동으로 close되어 편리합니다. 또, 파일을 열고 진행하는 작업이 복잡하면 close문의 작성을 빼먹을 수 있기 때문에 위와 같이 작성하는 것이 간결하면서 안정적이라고 볼 수 있습니다. 내부적으로 'context manager' 객체의 동작을 통해 이런 작업들이 가능합니다.

## 파일을 닫아주지 않으면?

파일을 닫아주지 않으면 어떻게 될까?에 대한 조금 더 자세한 내용을 다루기 때문에 넘어가셔도 좋습니다. 파일을 닫아주지 않고 계속 파일을 연다면 다음과 같은 상황이 생길 수 있습니다.

```python
file_descriptors = []
for x in range(100000):
    file_descriptors.append(open('test.txt', 'w'))
```

```
Output

OSError: [Errno 24] Too many open files: 'test.txt'
```

'누가 파일을 10만개씩 여는가?', '너무 극단적인 예시다.'라고 생각하실 수도 있습니다. 하지만 파일을 여는 것 역시 제한적인 자원을 사용하는 것이라는 것을 알려드리고 싶었습니다.

파일을 쓰는 작업은 사용자 프로그램에서 바로 쓰기 작업을 하는 것이 아닙니다. 보안상 이유로 사용자 프로그램은 운영체제에 파일을 쓰기 위해 요청하고 결국 작업은 운영체제에서 합니다. 운영체제는 어떤 파일에 작업할지 식별하기 위해 'File descriptor table'을 관리합니다. File마다 descriptor라는 index가 있고, 이 index를 통해 접근하는 것입니다. 그런데 위와 같이 파일을 너무 열고 닫아주지 않으면 테이블을 통해 모두 관리할 수 없으니 OSError가 나는 것입니다. 파일 기술자(file descriptor)를 모두 소비하는 것만의 문제는 아니지만 제한된 자원이고 내부적으로 이렇게 동작한다는 것을 약간이나마 알려드리고 싶어 작성해보았습니다.

## 실습해보기

실습 해볼 과제는 '하위 디렉토리 검색하기'입니다. 특정 디렉토리의 하위에 있는 모든 특정 확장자의 파일을 탐색하는 프로그램을 작성하는 것입니다.

```python
def search(directory_name, extension):
    # TODO: implement here
    pass

search('/projects', '.py')
```

주의해야 할 것은 해당 디렉토리 내부에 있는 또 다른 디렉토리 내부에도 파일들이 있을 수 있다는 것입니다. os.walk()를 사용하면 간단하게 구현할 수 있지만 재귀 개념도 익히는 기회로 생각하셨으면 좋겠습니다. 포맷 자체는 위 코드의 틀대로 작성하셔도 좋고, 하위 디렉토리를 검색하는 프로그램을 자유롭게 작성하셔도 좋습니다.

[점프 투 파이썬 하위 디렉토리 검색하기](https://wikidocs.net/39)

'점프 투 파이썬'이라는 입문서에서도 다루고 있는 내용입니다. 바로 링크를 참고하기보다는 작성을 마친 다음 참고하시는 것을 추천합니다.
